// var data = {
//   "Survey": [
//     {
//       "surveyId": 34,
//       "surveyName": "Project Services Survey",
//       "surveyStart": "10/06/2016",
//       "surveyEnd": "10/07/2016"
//     },
//     {
//       "surveyId": 35,
//       "surveyName": "Production Support Survey",
//       "surveyStart": "10/06/2016",
//       "surveyEnd": "10/07/2016"
//     }
//   ],
//   "Category": [
//     {
//       "categoryId": 2,
//       "surveyid": 34,
//       "categoryName": "Quality of Delivery / Service"
//     },
//     {
//       "categoryId": 3,
//       "surveyid": 34,
//       "categoryName": "Quality of Experience"
//     },
//     {
//       "categoryId": 4,
//       "surveyid": 34,
//       "categoryName": "Business Value"
//     },
//     {
//       "categoryId": 5,
//       "surveyid": 35,
//       "categoryName": "Quality of Delivery / Service"
//     },
//     {
//       "categoryId": 6,
//       "surveyid": 35,
//       "categoryName": "Quality of Experience"
//     },
//     {
//       "categoryId": 7,
//       "surveyid": 35,
//       "categoryName": "Business Value"
//     }
//   ],
//   "Question": [
//     {
//       "surveyid": 34,
//       "categoryid": 2,
//       "questionId": 2,
//       "type": "Radio",
//       "question": "Does the TCS IT team deliver CRs on time and according to project plan and SOW?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 2,
//       "questionId": 3,
//       "type": "Radio",
//       "question": "Does the TCS IT team provide services which meet your expectations? Are all the delivered CRs in-line with the BRDs?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 2,
//       "questionId": 4,
//       "type": "Radio",
//       "question": "Does the TCS IT team provide services within budget and according to SOW?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 2,
//       "questionId": 5,
//       "type": "Radio",
//       "question": "Does the TCS IT team provide proper documentation?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 6,
//       "type": "Radio",
//       "question": "Does the TCS IT Team exhibit proper domain knowledge to meet your business requirements?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 7,
//       "type": "Radio",
//       "question": "Does the TCS IT Team exhibit proper technical knowledge to meet your business requirements?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 8,
//       "type": "Radio",
//       "question": "Does the TCS IT Team ensure ready availability and accessibility of key resources ?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 9,
//       "type": "Radio",
//       "question": "Does the TCS IT Team respond quickly to queries and complaints?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 10,
//       "type": "Radio",
//       "question": "Does the TCS IT Team proactively manage project risks? Are these risks visualised before time?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 11,
//       "type": "Radio",
//       "question": "Does the TCS IT Team uphold government policies and Information Transparency and Security?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 12,
//       "type": "Radio",
//       "question": "Does the TCS IT Team cooperates and collaborates with your for achieving common business objectives? Does the team ensure smooth delivery and handover of the releases?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 3,
//       "questionId": 13,
//       "type": "Radio",
//       "question": "Does the TCS IT Team uphold and adhere to the Information Security as well as Business Continuity policies?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 4,
//       "questionId": 14,
//       "type": "Radio",
//       "question": "Does the TCS IT Team deliver anticipated business value according to your expectations?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 4,
//       "questionId": 15,
//       "type": "Radio",
//       "question": "Does the TCS IT Team proactively provide new ideas to meet your business objectives?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 4,
//       "questionId": 16,
//       "type": "Radio",
//       "question": "Does the TCS IT Team proactively provide new Performance and Process Improvements to enhance the Application / product? "
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 4,
//       "questionId": 17,
//       "type": "Free Text",
//       "question": "What are the Top 3 Strengths of TCS GTB Team in your perspective?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 4,
//       "questionId": 18,
//       "type": "Free Text",
//       "question": "What are the Top 3 Improvement Opportunities of TCS GTB Team in your perspective?"
//     },
//     {
//       "surveyid": 34,
//       "categoryid": 4,
//       "questionId": 19,
//       "type": "Free Text",
//       "question": "Any other comments."
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 5,
//       "questionId": 20,
//       "type": "Radio",
//       "question": "Does the TCS IT team deliver production issues resolution on time, which meets Scheduled Commitments?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 5,
//       "questionId": 21,
//       "type": "Radio",
//       "question": "Does the TCS IT team provide services which meet your expectations?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 5,
//       "questionId": 22,
//       "type": "Radio",
//       "question": "Does TCS team ensure availability of application systems to users with expected level of system performance?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 6,
//       "questionId": 23,
//       "type": "Radio",
//       "question": "Does the TCS IT Team exhibit proper domain knowledge to meet your business requirements?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 6,
//       "questionId": 24,
//       "type": "Radio",
//       "question": "Does the TCS IT Team exhibit proper technical knowledge to meet your business requirements?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 6,
//       "questionId": 25,
//       "type": "Radio",
//       "question": "Does the TCS IT Team ensure ready availability and accessibility of key resources ?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 6,
//       "questionId": 26,
//       "type": "Radio",
//       "question": "Does the TCS IT Team respond quickly to queries and complaints?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 6,
//       "questionId": 27,
//       "type": "Radio",
//       "question": "Does the TCS IT Team cooperates and collaborates with your for achieving common business objectives? Does the team ensure smooth delivery and handover of the releases?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 6,
//       "questionId": 28,
//       "type": "Radio",
//       "question": "Does the TCS IT Team uphold and adhere to the Information Security as well as Business Continuity policies?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 7,
//       "questionId": 29,
//       "type": "Radio",
//       "question": "Does the TCS IT Team proactively provide new ideas / Process Improvement  to meet your business objectives?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 7,
//       "questionId": 30,
//       "type": "Free Text",
//       "question": "What are the Top 3 Strengths of TCS Support Team in your perspective?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 7,
//       "questionId": 31,
//       "type": "Free Text",
//       "question": "What are the Top 3 Improvement Opportunities of TCS Support Team in your perspective?"
//     },
//     {
//       "surveyid": 35,
//       "categoryid": 7,
//       "questionId": 32,
//       "type": "Free Text",
//       "question": "Any other comments."
//     }
//   ]
// } ;

var data = null;

var db = openDatabase('Survey', '1.0', 'Test DB', 5 * 1024 * 1024);
var finalobject = {};

function createTable() {
	db
			.transaction(function(tx) {
				tx
						.executeSql('CREATE TABLE IF NOT EXISTS Login (id INTEGER PRIMARY KEY, Username, Password, Token)');
				tx
						.executeSql('CREATE TABLE IF NOT EXISTS Survey_Master (id INTEGER PRIMARY KEY, Surveyid, Name, Startdate, Enddate, Completedstatus, SyncStatus)');
				tx
						.executeSql('CREATE TABLE IF NOT EXISTS Category_Master (id INTEGER PRIMARY KEY, Surveyid, Categoryid, Categoryname)');
				tx
						.executeSql('CREATE TABLE IF NOT EXISTS Question_Master(id INTEGER PRIMARY KEY, Surveyid, Categoryid, QuestionId, Type, Question, Answer, Remarks, Importance, Answerdate, NotApplicable)');
			});
}

function dropAllTables() {
	db.transaction(function(tx) {
		tx.executeSql('DROP TABLE Login');
		tx.executeSql('DROP TABLE Survey_Master');
		tx.executeSql('DROP TABLE Category_Master');
		tx.executeSql('DROP TABLE Question_Master');
	});
}

function insertIntoSurveyMaster() {
	createTable();

	data = JSON.parse(localStorage.getItem('surveyData'));
	var existingSurveyId = [];
	var existingSurveyExpiryDate = [];
	db.transaction(function(tx) {
		tx.executeSql('SELECT * FROM Survey_Master', [],
				function(tx, results) {
					firstLength = results.rows.length, firstLength;
					for ( var i = 0; i < firstLength; i++) {
						existingSurveyId.push(results.rows.item(i).Surveyid);
						existingSurveyExpiryDate
								.push(results.rows.item(i).Enddate);
					}

					for ( var key in data.Survey) {

						if (jQuery.inArray(data.Survey[key].surveyId,
								existingSurveyId) != -1) {
							data.Survey[key] = '';
						}
					}

					tx.executeSql('SELECT * FROM Category_Master', [],
							function(tx, results) {
								var existingCategoryId = [];
								categoryLength = results.rows.length,
										categoryLength;

								for ( var i = 0; i < categoryLength; i++) {
									existingCategoryId.push(results.rows
											.item(i).Categoryid);
								}

								for ( var key in data.Category) {
									if (jQuery.inArray(
											data.Category[key].categoryId,
											existingCategoryId) != -1) {
										data.Category[key] = '';
									}
								}
							});

					for ( var key in data.Question) {
						if (jQuery.inArray(data.Question[key].surveyid,
								existingSurveyId) != -1) {
							data.Question[key] = '';
						}
					}

				});
	});

	setTimeout(
			function() {
				db
						.transaction(function(tx) {
							for ( var i = 0; i < data.Survey.length; ++i) {
								if (data.Survey[i] != '') {
									tx
											.executeSql(
													'INSERT INTO Survey_Master(Surveyid,Name,Startdate,Enddate,Completedstatus,SyncStatus) VALUES (?,?,?,?,?,?)',
													[
															(data.Survey[i].surveyId).trim(),
															data.Survey[i].surveyName,
															data.Survey[i].surveyStart,
															data.Survey[i].surveyEnd,
															'N', 'N' ]);
								}

							}
						});
				insertIntoCategoryMaster();
			}, 200);

}

function insertIntoCategoryMaster() {
	db
			.transaction(function(tx) {
				for ( var i = 0; i < data.Category.length; ++i) {
					if (data.Category[i] != '') {
						tx
								.executeSql(
										'INSERT INTO Category_Master(Surveyid,Categoryid,Categoryname) VALUES (?,?,?)',
										[ data.Category[i].surveyid,
												data.Category[i].categoryId,
												data.Category[i].categoryName ]);
					}
				}
			});
	insertIntoQuestionMaster();
}

function insertIntoQuestionMaster() {
	db
			.transaction(function(tx) {
				for ( var i = 0; i < data.Question.length; ++i) {
					if (data.Question[i] != '') {
						tx
								.executeSql(
										'INSERT INTO Question_Master(Surveyid,Categoryid,QuestionId,Type,Question,Importance) VALUES (?,?,?,?,?,?)',
										[ data.Question[i].surveyid.trim(),
												data.Question[i].categoryid,
												data.Question[i].questionId,
												data.Question[i].type,
												data.Question[i].question,
												'High' ]);
					}
				}
			});
}

function updateAnswerOnServer(userid) {
	var completedSurveyId = '';
	var submitArray = [];
	var uploadId = [];
	db
			.transaction(function(tx) {
				tx
						.executeSql(
								'SELECT * FROM Survey_Master WHERE Completedstatus = ? AND SyncStatus = ?',
								[ 'Y', 'N' ],
								function(tx, results) {
									firstLength = results.rows.length,
											firstLength;
									for ( var i = 0; i < firstLength; i++) {
										uploadId[i] = results.rows.item(i).Surveyid;
									}
								}, null);
			});

	window
			.setTimeout(
					function() {
						db
								.transaction(function(tx) {
									for ( var j = 0; j < uploadId.length; j++) {
										tx
												.executeSql(
														'SELECT * FROM Question_Master WHERE Surveyid = ?',
														[uploadId[j]],
														function(tx, results) {

																	secondLength = results.rows.length,
																	secondLength;
															for ( var i = 0; i < secondLength; i++) {
																var answer = {
																	"SurveyId" : results.rows
																			.item(i).Surveyid,
																	"CategoryId" : results.rows
																			.item(i).Categoryid,
																	"UserId" : userid,
																	"QuestionId" : results.rows
																			.item(i).QuestionId,
																	"Answer" : results.rows
																			.item(i).Answer,
																	"Remarks" : results.rows
																			.item(i).Remarks,
																	"Date" : results.rows
																			.item(i).Answerdate,
																	"DataFrom": "WEB"
																};
																submitArray
																		.push(answer);
															}
															// localStorage.setItem('answerObject',
															// JSON.stringify(submitArray));
														}, null);
									}
								});
						window.setTimeout(function() {
							localStorage.setItem('answerObject', JSON
									.stringify(submitArray));
						}, 100);
					}, 1000);

}

function updateAnswers(updateData, completed) {

	db
			.transaction(function(tx) {
				for ( var i = 0; i < updateData.length; i++) {
					var answerArray = (updateData[i].answer).split('&;'), answer = answerArray[0], remarks;

					if (answerArray[1]) {
						remarks = answerArray[1];
					} else {
						remarks = '';
					}

					var surveyId = updateData[i].surveyId;
					var questionId = updateData[i].questionId;

					
					  tx .executeSql( 'UPDATE Question_Master SET Answer = ? , Remarks = ?, Answerdate = ?, NotApplicable = ? WHERE QuestionId= ?', [ answer, remarks,
					  updateData[i].answerDateTime,
					  updateData[i].notApplicable, questionId ]);
					 

					if (completed) {
						tx
								.executeSql(
										'UPDATE Survey_Master SET Completedstatus = ? WHERE Surveyid = ?',
										[ 'Y', surveyId ]);
					}
				}

			});
}

function updateSurveySyncStatus(surveyId) {
	var sId = surveyId;
	db.transaction(function(tx) {
		tx.executeSql(
				'UPDATE Survey_Master SET SyncStatus = ? WHERE Surveyid = ?', [
						'Y', sId ]);
	});
}

function generateJson() {
	var firstObject;
	var secondObject;
	var thirdObject;
	var firstLength;
	var secondLength;
	var thirdLength;
	var surveyData = [];

	db.transaction(function(tx) {
		tx.executeSql('SELECT * FROM Survey_Master', [], function(tx, results) {
			firstLength = results.rows.length, firstLength;

			firstObject = results;

		}, null);
	});

	db.transaction(function(tx) {
		tx.executeSql('SELECT * FROM Category_Master', [],
				function(tx, results) {
					secondLength = results.rows.length, secondLength;
					secondObject = results;

				}, null);
	});
	db.transaction(function(tx) {
		tx.executeSql('SELECT * FROM Question_Master', [],
				function(tx, results) {
					thirdLength = results.rows.length, thirdLength;
					thirdObject = results;

				}, null);
	});

	window
			.setTimeout(
					function() {
						/*
						 * console.log("firstObject
						 * "+firstObject.rows.item(0).Name +" "+firstLength);
						 * console.log("secondObject
						 * "+secondObject.rows.item(0).Categoryname+"
						 * "+secondLength); console.log("thirdObject
						 * "+thirdObject.rows.item(0).Question+" "+thirdLength);
						 */

						for ( var i = 0; i < firstLength; i++) {
							var dataobjects = {};
							var first = firstObject.rows.item(i).Surveyid;
							dataobjects["surveyId"] = firstObject.rows.item(i).Surveyid;
							dataobjects["surveyName"] = firstObject.rows
									.item(i).Name;
							dataobjects["surveyStart"] = firstObject.rows
									.item(i).Startdate;
							dataobjects["surveyEnd"] = firstObject.rows.item(i).Enddate;
							dataobjects["syncStatus"] = firstObject.rows
									.item(i).SyncStatus;
							var categoryCompleteList = [];
							for ( var j = 0; j < secondLength; j++) {
								// if(first==secondObject.rows.item(j).Surveyid){
								if (!(secondObject.rows.item(j).Categoryid in categoryCompleteList)) {
									var category = {
										"categoryId" : secondObject.rows
												.item(j).Categoryid,
										"categoryName" : secondObject.rows
												.item(j).Categoryname
									};
									categoryCompleteList.push(category);
								}
								// }
							}
							dataobjects.categoryCompleteList = categoryCompleteList;
							var questionList = [];
							var categoryList = [];
							for ( var k = 0; k < thirdLength; k++) {
								if (first == (thirdObject.rows.item(k).Surveyid)
										.trim()) {
									var Question = {
										"categoryId" : thirdObject.rows.item(k).Categoryid,
										"questionId" : thirdObject.rows.item(k).QuestionId,
										"type" : thirdObject.rows.item(k).Type,
										"question" : thirdObject.rows.item(k).Question,
										"answer" : thirdObject.rows.item(k).Answer,
										"remarks" : thirdObject.rows.item(k).Remarks,
										"importance" : thirdObject.rows.item(k).Importance,
										"notApplicable" : thirdObject.rows
												.item(k).NotApplicable
									};
									questionList.push(Question);

									if (!(thirdObject.rows.item(k).Categoryid in categoryList)) {
										var category = {
											"categoryId" : (thirdObject.rows
													.item(k).Categoryid).trim(),
										};
										for ( var property in dataobjects.categoryCompleteList) {
											if ((dataobjects.categoryCompleteList)
													.hasOwnProperty(property)) {
												if ((dataobjects.categoryCompleteList[property].categoryId).trim() == (thirdObject.rows
														.item(k).Categoryid).trim()) {
													category.categoryName = dataobjects.categoryCompleteList[property].categoryName;
												}
											}
										}
										categoryList.push(category);
									}
								}
							}
							dataobjects.categoryList = categoryList;
							dataobjects.questionList = questionList;
							surveyData.push(dataobjects);

						}
						localStorage.setItem('surveyData', JSON
								.stringify(surveyData));
						// return(JSON.stringify(surveyData));
					}, 200);

}

/*
 * function insertIntoLogin(username,password,token){
 * db.transaction(function(tx){ tx.executeSql('INSERT INTO
 * Login(Username,Password,Token) VALUES (?,?,?)',[username,password,token]);
 * }); }
 * 
 * 
 * function insertOpportunitydata(data, mbpk){ db.transaction(function(tx){ var
 * i = 0; tx.executeSql("UPDATE Userdata SET AssetValue=?, IRR=?, LoanAmount=?,
 * Segment=?, Tenure=?, Sync_Status=? WHERE MobilePK = ?",
 * [data.Opportunity.AssetValue, data.Opportunity.IRR,
 * data.Opportunity.LoanAmount, data.Opportunity.Segment,
 * data.Opportunity.Tenure, data.MetaData.Sync_Status, mbpk] ); }); }
 * 
 * 
 * function insertRescheduleMeetingdata(data, mbpk){
 * db.transaction(function(tx){ var i = 0; tx.executeSql("UPDATE Userdata SET
 * Meetinglocation=?, MeetingTime=?, Remarks=?, Sync_Status=? WHERE MobilePK =
 * ?", [data.meeting.Meetinglocation, data.meeting.MeetingTime,
 * data.meeting.Remarks, 'U', mbpk] ); }); }
 * 
 * function insertIntoUserdata(data, mbpk, directOpp){
 * 
 * createTable(); if(mbpk) { db.transaction(function(tx){ var i = 0;
 * tx.executeSql("UPDATE Userdata SET LeadType=?, Product=?, Channel=?,
 * FinanaceType=?, FinanaceCategory=?, FName=?, LName=?, MobileNo=?,Address1=?,
 * Address2=?, Address3=?, City=?, Meetinglocation=?,MeetingTime=?,Sync_Status=?
 * WHERE MobilePK = ?",[data.TransactionData[i].Lead.LeadType,
 * data.TransactionData[i].Lead.Product, data.TransactionData[i].Lead.Channel,
 * data.TransactionData[i].Lead.FinanaceType,
 * data.TransactionData[i].Lead.FinanaceCategory,
 * data.TransactionData[i].Lead.FName, data.TransactionData[i].Lead.LName,
 * data.TransactionData[i].Lead.MobileNo,
 * data.TransactionData[i].Lead.Addreess1,
 * data.TransactionData[i].Lead.Addreess2,
 * data.TransactionData[i].Lead.Addreess3, data.TransactionData[i].Lead.City,
 * data.TransactionData[i].Lead.Meetinglocation,
 * data.TransactionData[i].Lead.MeetingTime,
 * data.TransactionData[i].MetaData.Sync_Status,
 * data.TransactionData[i].MetaData.Mobile_PK] ); }); } else {
 * db.transaction(function(tx){ for(var i = 0; i < data.TransactionData.length;
 * ++i){
 * 
 * 
 * tx.executeSql('INSERT INTO Userdata (LeadType, Product, Channel,
 * FinanaceType, FinanaceCategory, FName, LName, MobileNo,Address1, Address2,
 * Address3, City,
 * Meetinglocation,MeetingTime,CreationDate,LeadId,Segment,AssetValue,LoanAmount,Tenure,IRR,Sync_Status,OpportunityId,Favourite,DateTime,
 * MobilePK, UserId, Remarks) VALUES
 * (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)',[data.TransactionData[i].Lead.LeadType,
 * data.TransactionData[i].Lead.Product,data.TransactionData
 * 
 * [i].Lead.Channel,data.TransactionData[i].Lead.FinanaceType,data.TransactionData[i].Lead.FinanaceCategory,data.TransactionData
 * 
 * [i].Lead.FName,data.TransactionData[i].Lead.LName,data.TransactionData[i].Lead.MobileNo,data.TransactionData
 * 
 * [i].Lead.Addreess1,data.TransactionData[i].Lead.Addreess2,data.TransactionData[i].Lead.Addreess3,data.TransactionData
 * 
 * [i].Lead.City,data.TransactionData[i].Lead.Meetinglocation,data.TransactionData[i].Lead.MeetingTime,data.TransactionData
 * 
 * [i].Lead.CreationDate,data.TransactionData[i].Opportunity.LeadId,data.TransactionData
 * 
 * [i].Opportunity.Segment,data.TransactionData[i].Opportunity.AssetValue,data.TransactionData
 * 
 * [i].Opportunity.LoanAmount,data.TransactionData[i].Opportunity.Tenure,data.TransactionData
 * 
 * [i].Opportunity.IRR,data.TransactionData[i].MetaData.Sync_Status,data.TransactionData
 * 
 * [i].MetaData.OpportunityId,"","",data.TransactionData
 * 
 * [i].MetaData.Mobile_PK,data.TransactionData[i].MetaData.UserId,""]) } },
 * function(tx,error){ console.log(error) }); } }
 * 
 * function displayDataOnGrid(){
 * 
 * var TransactionData=[]; finalobject.TransactionData=[];
 * db.transaction(function(tx){ tx.executeSql('SELECT * FROM Userdata', [],
 * function (tx, results) { localStorage.removeItem('finalobject'); var len =
 * results.rows.length, i; for (i = 0; i < len; i++){
 * 
 * var lead ={ "FName" : results.rows.item(i).FName, "LName"
 * :results.rows.item(i).LName, "MobileNo" :results.rows.item(i).MobileNo,
 * "Address1":results.rows.item(i).Address1,
 * "Address2":results.rows.item(i).Address2,
 * "Address3":results.rows.item(i).Address3, "City":results.rows.item(i).City,
 * "Meetinglocation":results.rows.item(i).Meetinglocation,
 * "MeetingTime":results.rows.item(i).MeetingTime,
 * "LeadType":results.rows.item(i).LeadType,
 * "Product":results.rows.item(i).Product,
 * "Channel":results.rows.item(i).Channel,
 * "FinanaceType":results.rows.item(i).FinanaceType,
 * "FinanaceCategory":results.rows.item(i).FinanaceCategory, "CreationDate":
 * results.rows.item(i).CreationDate, "Remarks": results.rows.item(i).Remarks };
 * var oppurtinity={ "LeadId":results.rows.item(i).LeadId,
 * "Segment":results.rows.item(i).Segment,
 * "AssetValue":results.rows.item(i).AssetValue,
 * "LoanAmount":results.rows.item(i).LoanAmount,
 * "Tenure":results.rows.item(i).Tenure, "IRR":results.rows.item(i).IRR }; var
 * metadata={ "UserId":results.rows.item(i).UserId,
 * "Mobile_PK":results.rows.item(i).MobilePK,
 * "LeadId":results.rows.item(i).LeadId,
 * "OpportunityId":results.rows.item(i).OpportunityId,
 * "Sync_Status":results.rows.item(i).Sync_Status, "Token_Id":"1256xyfyufu" };
 * var values={ "Lead":lead, "Opportunity":oppurtinity, "MetaData":metadata };
 * finalobject.TransactionData.push(values); } //console.log(finalobject);
 * localStorage.setItem('finalobject', JSON.stringify(finalobject)); }, null);
 * }); //return finalobject; }
 * 
 * function updateFavourite(favouriteValue,whereid){
 * db.transaction(function(tx){ tx.executeSql('UPDATE Userdata SET Favourite = ?
 * WHERE id = ?',[favouriteValue,whereid]); }); }
 * 
 * function updateLeadTable(Meetinglocation,MeetingDate,MeetingTime,Remark){
 * db.transaction(function(tx){ tx.executeSql('UPDATE Userdata SET
 * Meetinglocation = ? MeetingDate = ? MeetingTime = ? Remark = ? WHERE id =
 * ?',[Meetinglocation,MeetingDate,MeetingTime,Remark,id]); }); }
 * 
 * function GenerateJsonForSync(){ var finalobject1={}; var allocObject={}; var
 * TransactionData=[]; finalobject1.TransactionData=TransactionData;
 * db.transaction(function(tx){ tx.executeSql('SELECT * FROM Userdata WHERE
 * Sync_Status = ? OR Sync_Status = ? OR Sync_Status = ?', ['N','O','U'],
 * function (tx, results) { var len = results.rows.length, i; for (i = 0; i <
 * len; i++){ //console.log(results.rows.item(i)); var lead ={ "FName" :
 * results.rows.item(i).FName, "LName" :results.rows.item(i).LName, "MobileNo"
 * :results.rows.item(i).MobileNo, "Address1":results.rows.item(i).Address1,
 * "Address2":results.rows.item(i).Address2,
 * "Address3":results.rows.item(i).Address3, "City":results.rows.item(i).City,
 * "Meetinglocation":results.rows.item(i).Meetinglocation,
 * "MeetingTime":results.rows.item(i).MeetingTime,
 * "LeadType":results.rows.item(i).LeadType,
 * "Product":results.rows.item(i).Product,
 * "Channel":results.rows.item(i).Channel,
 * "FinanaceType":results.rows.item(i).FinanaceType,
 * "FinanaceCategory":results.rows.item(i).FinanaceCategory, "CreationDate":
 * results.rows.item(i).CreationDate }; var oppurtinity={
 * "LeadId":results.rows.item(i).LeadId, "Segment":results.rows.item(i).Segment,
 * "AssetValue":results.rows.item(i).AssetValue,
 * "LoanAmount":results.rows.item(i).LoanAmount,
 * "Tenure":results.rows.item(i).Tenure, "IRR":results.rows.item(i).IRR }; var
 * metadata={ "UserId":results.rows.item(i).UserId,
 * "Mobile_PK":results.rows.item(i).MobilePK,
 * "LeadId":results.rows.item(i).LeadId,
 * "OpportunityId":results.rows.item(i).OpportunityId,
 * "Sync_Status":results.rows.item(i).Sync_Status, "Token_Id":"1256xyfyufu" };
 * var values={ "Lead":lead, "Opportunity":oppurtinity, "MetaData":metadata };
 * var allocInput={ "UserId": results.rows.item(i).UserId, "Token_Id":
 * "123213sdjjfksjf" }; finalobject1.TransactionData.push(values); //
 * allocObject.push(allocInput);
 * //console.log(finalobject1.TransactionData[0].MetaData.Mobile_PK); }
 * //console.log(JSON.stringify(allocObject));
 * localStorage.setItem('finalobject1', JSON.stringify(finalobject1));
 * //console.log("db finalobj"+localStorage.getItem('finalobject1')); }, null);
 * }); return finalobject1; } //WHERE Sync_Status LIKE = ? '
 * 
 * function checkEntryStatusOnServer(){ var primaryObject={}; var RSyncData=[];
 * primaryObject.RSyncData=RSyncData; db.transaction(function(tx){
 * tx.executeSql('SELECT id,LeadId,OpportunityId,Sync_Status,MobilePK FROM
 * Userdata WHERE Sync_Status = ? OR Sync_Status = ?', ['L','OR'],function (tx,
 * results) { var len = results.rows.length, i; for (i = 0; i < len; i++){ var
 * values={ "UserId" : "99010969", "Mobile_PK" : results.rows.item(i).MobilePK,
 * "LeadId" :results.rows.item(i).LeadId,
 * "OpportunityId":results.rows.item(i).OpportunityId,
 * "Sync_Status":results.rows.item(i).Sync_Status, //"Sync_Status":"N",
 * "Token_Id" : "sdfd" };
 * 
 * primaryObject.RSyncData.push(values); } // console.log("RSync Value :" +
 * JSON.stringify(primaryObject)); localStorage.setItem('primaryObject',
 * JSON.stringify(primaryObject)); console.log("RSync Input :
 * "+localStorage.getItem('primaryObject')); },null);
 * 
 * }); }
 * 
 * function updateEntryStatus(SyncDataOutput){ // var
 * RSyncDataOutput=(localStorage.getItem('RSyncDataOutput')); //
 * console.log("Received at db: "+RSyncDataOutput.RSyncData);
 * db.transaction(function(tx){ for(var i = 0; i <
 * SyncDataOutput.SyncOutput.length; i++){ tx.executeSql("UPDATE Userdata SET
 * LeadId=?, OpportunityId=?, Sync_Status=? WHERE MobilePK =
 * ?",[SyncDataOutput.SyncOutput[i].LeadId,SyncDataOutput.SyncOutput[i].OpportunityId,SyncDataOutput.SyncOutput[i].Sync_Status,SyncDataOutput.SyncOutput[i].Mobile_PK]); }
 * }); }
 * 
 * 
 * 
 * function countLead(){
 * 
 * db.transaction(function(tx){ tx.executeSql('SELECT * FROM Userdata WHERE
 * Sync_Status =?', ['L'], function (tx, results) { var len =
 * results.rows.length, i; var output = document.getElementById('dispLead');
 * output.innerHTML = len; }, null);
 * 
 * }); }
 * 
 * function countOpp(){
 * 
 * db.transaction(function(tx){ tx.executeSql('SELECT * FROM Userdata WHERE
 * Sync_Status =?', ['o'], function (tx, results) { var len =
 * results.rows.length, i; var output = document.getElementById('dispOpp');
 * output.innerHTML = len; }, null);
 * 
 * }); }
 * 
 * function countTotal(){
 * 
 * db.transaction(function(tx){ tx.executeSql('SELECT * FROM Userdata', [],
 * function (tx, results) { var len = results.rows.length, i; var output =
 * document.getElementById('dispTotal'); output.innerHTML = len; }, null);
 * 
 * }); }
 * 
 * var allocatedData={ "AllocationList": [ { "Lead": { "LeadType": "Individual",
 * "Product": "Nano", "Channel": "New", "FinanaceType": "New",
 * "FinanaceCategory": "NewFinance", "FName": "Sumeet", "LName": "Kapoor",
 * "MobileNo": "9854410101", "Address1": "A101", "Address2": "Hello Apartments",
 * "Address3": "Mumbai", "City": "Mumbai", "Meetinglocation": "Vivivanna Mall",
 * "MeetingTime": "13/04/2016 5PM" }, "Opportunity": { "LeadId": "144071",
 * "Segment": "Retail", "AssetValue": "65900", "LoanAmount": "74120", "Tenure":
 * "5", "IRR": "14" }, "MetaData": { "UserId": "99020999", "Mobile_PK": "",
 * "LeadId": "144071", "OpportunityId": "", "Sync_Status": "L", "Token_Id":
 * "1256xyfyufu" } }, { "Lead": { "LeadType": "Organization", "Product":
 * "Safari", "Channel": "New", "FinanaceType": "New", "FinanaceCategory":
 * "NewFin", "FName": "Harpreet", "LName": "Singh", "MobileNo": "9871100115",
 * "Address1": "C908", "Address2": "Sunshine Building", "Address3": "Sector 5",
 * "City": "Vashi", "Meetinglocation": "Korum Mall", "MeetingTime": "15/04/2016
 * 1PM" }, "Opportunity": { "LeadId": "144080", "Segment": "Retail",
 * "AssetValue": "984500", "LoanAmount": "564120", "Tenure": "9", "IRR": "7" },
 * "MetaData": { "UserId": "99020999", "Mobile_PK": "", "LeadId": "144080",
 * "OpportunityId": "", "Sync_Status": "L", "Token_Id": "1256xyfyufu" } } ] }
 * 
 * 
 * function insertAllocatedData(){ db.transaction(function(tx){ for(var i = 0; i <
 * allocatedData.AllocationList.length; ++i){
 * 
 * tx.executeSql('INSERT INTO Userdata (LeadType, Product, Channel,
 * FinanaceType, FinanaceCategory, FName, LName, MobileNo,Address1, Address2,
 * Address3, City,
 * Meetinglocation,MeetingTime,CreationDate,LeadId,Segment,AssetValue,LoanAmount,Tenure,IRR,Sync_Status,OpportunityId,Favourite,DateTime,
 * MobilePK, UserId) VALUES
 * (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)',[allocatedData.AllocationList[i].Lead.LeadType,
 * allocatedData.AllocationList[i].Lead.Product,allocatedData.AllocationList
 * 
 * [i].Lead.Channel,allocatedData.AllocationList[i].Lead.FinanaceType,allocatedData.AllocationList[i].Lead.FinanaceCategory,allocatedData.AllocationList
 * 
 * [i].Lead.FName,allocatedData.AllocationList[i].Lead.LName,allocatedData.AllocationList[i].Lead.MobileNo,allocatedData.AllocationList
 * 
 * [i].Lead.Addreess1,allocatedData.AllocationList[i].Lead.Addreess2,allocatedData.AllocationList[i].Lead.Addreess3,allocatedData.AllocationList
 * 
 * [i].Lead.City,allocatedData.AllocationList[i].Lead.Meetinglocation,allocatedData.AllocationList[i].Lead.MeetingTime,allocatedData.AllocationList
 * 
 * [i].Lead.CreationDate,allocatedData.AllocationList[i].Opportunity.LeadId,allocatedData.AllocationList
 * 
 * [i].Opportunity.Segment,allocatedData.AllocationList[i].Opportunity.AssetValue,allocatedData.AllocationList
 * 
 * [i].Opportunity.LoanAmount,allocatedData.AllocationList[i].Opportunity.Tenure,allocatedData.AllocationList
 * 
 * [i].Opportunity.IRR,allocatedData.AllocationList[i].MetaData.Sync_Status,allocatedData.AllocationList
 * 
 * [i].MetaData.OpportunityId,"","",allocatedData.AllocationList
 * 
 * [i].MetaData.Mobile_PK,allocatedData.AllocationList[i].MetaData.UserId]) } },
 * function(tx,error){ console.log(error) }); }
 */